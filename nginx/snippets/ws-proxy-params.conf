# =====================================
# Common Websocket Proxy Parameters
# =====================================

proxy_http_version 1.1;

# WebSocket upgrade headers
proxy_set_header Upgrade $http_upgrade;           # Pass client's upgrade request
proxy_set_header Connection $connection_upgrade;   # Use mapped connection value

# Standard proxy headers for proper request forwarding
proxy_set_header Host $host;                      # Original hostname
proxy_set_header X-Real-IP $remote_addr;          # Client's real IP
proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; # Proxy chain
proxy_set_header X-Forwarded-Proto $scheme;       # Original protocol (https)
proxy_set_header X-Forwarded-Port $server_port;   # Original port (443)
proxy_set_header X-Forwarded-Scheme $scheme;      # Scheme for compatibility

# WebSocket-specific headers
proxy_set_header Sec-WebSocket-Extensions $http_sec_websocket_extensions;
proxy_set_header Sec-WebSocket-Key $http_sec_websocket_key;
proxy_set_header Sec-WebSocket-Version $http_sec_websocket_version;

# WebSocket-optimized timeouts (long-lived connections)
proxy_connect_timeout 10s;      # Quick connection to local container
proxy_send_timeout 86400s;      # 24 hours - WebSockets can be idle long
proxy_read_timeout 86400s;      # 24 hours - Wait for messages indefinitely

# Disable buffering for real-time communication
proxy_buffering off;            # Send responses immediately, don't buffer
proxy_request_buffering off;    # Stream request data immediately
